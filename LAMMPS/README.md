# MADna-LAMMPS
LAMMPS implementation of MADna, a coarse-grained model for sequence-dependent elasticity and conformation of DNA. **In order to run MADna within LAMMPS, the latter has to be built with the packages EXTRA-MOLECULE and EXTRA-PAIR**. Morover, for application of torque according to the scripts provided in the folder "additional" (see below), also the package EXTRA-FIX is needed. The code has been tested for the version 29 Sep 2021.

There are two folders, for which more details are provided below:
- **Initialization**: This folder contains all the scripts needed to create the topology and initial configuration of a double-stranded DNA molecule from its sequence
- **Analysis**: This folder contains analysis scripts to determine geometrical parameters of DNA (grooves, hrise, htwist, diameter, crookedness, extension) and the tangent-tangent correlation function needed to compute the persistence length

## Initialization
This folder contains scripts for generation of MADna topology and initial configuration of a double-stranded DNA molecule in LAMMPS format. To execute the scripts, **python3 is needed with libraries sys, os, numpy, copy**.  
From the user's perspective, the only relevant script is **Initialization.py**, which imports the other ones as libraries (further useful scripts are found in the subfolder "additional", as commented below). Usage of the script is pretty straightforward:
```
Initialization/Initialization.py sequence folder ionic_strength temperature
```
Hence, the script needs four inputs:
- sequence: the sequence of the leading strand in the 5'-3' direction
- folder: the folder where the various files will be stored (if the folder does not exist, it is created automatically)
- ionic strength: the ionic strength of the solution in mM
- temperature: the temperature of the system in K

For instance, the following command
```
Initialization/Initialization.py CAAGATGC mySim/initialization 150 300
```
creates the files needed to simulate a DNA molecule with sequence 5'-CAAGATGC-3' (corresponding to 5'-GCATCTTG-3' on the other strand) embedded in a solution containing 150 mM of salt and at temperature 300 K, and stores the file in the folder mySim/initialization

The script generates four files:
- **sequence.dat** contains the chosen sequence as a simple text
- **stdump.lammpstrj** contains the initial coordinates of the beads within the molecule, written in LAMMPS format
- **chain.dat** contains the topology of the molecule in LAMMPS format (units correspond to the "real" format in LAMMPS)
- **lammps.in** is a minimal script for simulation of the system in LAMMPS, where the dynamics is run for 10 ns with a dump every 10 ps. Note that a group of commented lines indicates the point of the script where additional features can be added (see below)

Additionally, in the subfolder "additional" there are two other useful scripts to implement a pulling force and a torque:
- **pulling_torque.py** generates the code to apply a pulling force and a torque in the z direction, according to the protocol employed in https://doi.org/10.1101/2021.12.02.470889 to generate Fig.6 (see section "Methods/Molecular dynamics Simulations/Stretch-torsion simulations"). Its usage is:
```
Initialization/additional/pulling_torque.py sequence force torque
```
where the force is in pN and the torque in pN·nm. The script gives as output the chunk of code to be added to lammps.in (as generated by initialization.py). For instance, running
```
Initialization/additional/pulling_torque.py CAAGATGC 3 7
```
generates the following patch, which applies a pulling force of 3 pN and a torque of 7 pN·nm to the molecule:
```
compute xu all property/atom xu
compute yu all property/atom yu
variable dx equal -0.5*(c_xu[19]+c_xu[27])
variable dy equal -0.5*(c_yu[19]+c_yu[27])
thermo_style custom v_dx v_dy
run 0
displace_atoms all move v_dx v_dy 0 units box
thermo_style one
group blockA1 id <= 5
group blockA2 id >= 42
group blockA union blockA1 blockA2
group fB id 19 27
group torque id <> 19 27
fix tetherA blockA spring/self 100 xyz
variable fxB equal -100*(c_xu[19]+c_xu[27])
variable fyB equal -100*(c_yu[19]+c_yu[27])
fix fB fB addforce v_fxB v_fyB 0.0216
fix torque torque addtorque 0 0 1.0070
```
- **pulling_AMBER_protocol.py** generates the code to apply a pulling force directed along the end-to-end vector of the DNA molecule, see Fig.4 and Fig.5 in  https://doi.org/10.1101/2021.12.02.470889 and section "Methods/Molecular dynamics Simulations/Benchmark simulations". Its usage is:
```
Initialization/additional/pulling_AMBER_protocol.py sequence force
```
where the force is in pN. For instance, running
```
Initialization/additional/pulling_AMBER_protocol.py CAAGATGC 3
```
generates the following patch, which applies a pulling force of 3 pN:
```
compute xu all property/atom xu
compute yu all property/atom yu
compute zu all property/atom zu
variable xcmA equal 0.5*(c_xu[4]+c_xu[42])
variable ycmA equal 0.5*(c_yu[4]+c_yu[42])
variable zcmA equal 0.5*(c_zu[4]+c_zu[42])
variable xcmB equal 0.5*(c_xu[19]+c_xu[27])
variable ycmB equal 0.5*(c_yu[19]+c_yu[27])
variable zcmB equal 0.5*(c_zu[19]+c_zu[27])
variable dr equal sqrt((v_xcmB-v_xcmA)*(v_xcmB-v_xcmA)+(v_ycmB-v_ycmA)*(v_ycmB-v_ycmA)+(v_zcmB-v_zcmA)*(v_zcmB-v_zcmA))
variable fxA equal -(v_xcmB-v_xcmA)*0.0216/v_dr
variable fyA equal -(v_ycmB-v_ycmA)*0.0216/v_dr
variable fzA equal -(v_zcmB-v_zcmA)*0.0216/v_dr
variable fxB equal -v_fxA
variable fyB equal -v_fyA
variable fzB equal -v_fzA
group fA id 4 42
group fB id 4 42
fix fA fA addforce v_fxA v_fyA v_fzA
fix fB fB addforce v_fxB v_fyB v_fzB
```
